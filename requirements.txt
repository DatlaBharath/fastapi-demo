import os
import logging
from yaml import safe_load, YAMLError

class YAMLParser:
    MAX_FILE_SIZE = 5 * 1024 * 1024  # 5 MB

    def __init__(self, file_path):
        self.file_path = file_path

    def is_valid_file(self):
        # Check if the file exists
        if not os.path.isfile(self.file_path):
            logging.error(f"File does not exist: {self.file_path}")
            raise ValueError("File does not exist.")
        
        # Check file extension
        if not self.file_path.lower().endswith(('.yaml', '.yml')):
            logging.error(f"Invalid file type: {self.file_path}")
            raise ValueError("Invalid file type. Only YAML files are allowed.")

        # Check file size and validate against negative values
        try:
            file_size = os.path.getsize(self.file_path)
            if file_size < 0:
                logging.error(f"File size is negative, indicating an error: {file_size} bytes")
                raise ValueError("File size is invalid.")
            if file_size > self.MAX_FILE_SIZE:
                logging.error(f"File size exceeds maximum limit: {file_size} bytes")
                raise ValueError("File size exceeds the maximum allowed limit of 5 MB.")
        except OSError as e:
            logging.error(f"Error retrieving file size: {e}")
            raise ValueError("Error during file size validation.")
        
        return True

    def parse_yaml(self):
        try:
            # Validate the file before parsing
            if self.is_valid_file():
                with open(self.file_path, 'r') as yaml_file:
                    try:
                        data = safe_load(yaml_file)
                    except YAMLError as yaml_error:
                        logging.error(f"Error parsing YAML content: {yaml_error}")
                        raise ValueError("Invalid YAML content.")
                return data
        except Exception as e:
            logging.error(f"An error occurred while processing the YAML file: {e}")
            raise ValueError(f"An error occurred while parsing the YAML file: {e}")